<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>VR Puzzle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.7.0/dist/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.5.x/dist/aframe-environment-component.min.js"></script>
  <style>
    #status {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 18px;
      z-index: 10;
      display: none;
      color: #0f0;
    }

    /* Popup Styles */
    #popupOverlay {
      position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; z-index:1000;
    }
    #popupBox {
      position: fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      background: #222; padding:2rem; border-radius:1rem; box-shadow:0 8px 20px rgba(0,0,0,0.5);
      text-align:center; display:none; z-index:1001; color: #fff;
    }
    #popupBox button { padding:0.5rem 1rem; margin:0 0.5rem; cursor:pointer; }
    #popupBox label { display:block; margin-top:1rem; }
  </style>
</head>
<body>
<div id="status"></div>

<a-scene background="color:#88c">

  <a-assets>
    <img id="puzzleTex" src="./shield.png">
    <img id="return" src="./rotate-solid-full.png">
  </a-assets>

  <!-- Immersive Environment -->
  <a-entity environment="preset: default;"></a-entity>

  <a-entity id="rig" position="0 1.6 4">
    <a-camera></a-camera>
  
    <!-- Rechter Controller mit Laser -->
    <a-entity 
      laser-controls="hand: right"
      raycaster="objects: .clickable">
    </a-entity>
  
    <!-- Linker Controller mit Laser -->
    <a-entity 
      laser-controls="hand: left"
      raycaster="objects: .clickable">
    </a-entity>
  </a-entity>

  <!-- Start-Permission Entity -->
  <a-entity id="startEntity" visible="true" position="0 4 -2" class="clickable">
    <a-plane id="startPlane" width="7" height="3" color="#fff" opacity="0.9">
      <a-text value="Willkommen zum Mathe-Quiz!" align="center" color="#000" width="6" position="0 0.9 0.05"></a-text>
      <a-text
        id="startText" 
        value="Bevor du starten kannst, braucht die Anwendung einige Berechtigungen.
          Diese helfen dabei, dein Spielerlebnis zu speichern und zu verbessern.
          Um die Berechtigungen zu widerrufen, klicke auf das Reset Symbol links oben neben den Statusanzeigen.
          Klicke mit dem Controller auf „Start“, um die Berechtigungsanfragen anzuzeigen oder das Spiel zu starten."
        align="center" color="#000" width="3.5" position="0 0 0.05">
      </a-text>
    </a-plane>
    <!-- Permission Status  -->
    <a-entity id="permDots" position="0 -0.6 0">
      <a-plane id="perm_border" width="0.16" height="0.16" color="#fff" position="-3.3 2 0"></a-plane>
      <a-plane id="resetBtn" class="clickable" width="0.12" height="0.12" material="src: #return; color: #fff; shader:flat; transparent: true" position="-3.3 2 0.01" animation__hoverin="startEvents: mouseenter; property: scale; to: 1.1 1.1 1; dur: 200"
      animation__hoverout="startEvents: mouseleave; property: scale; to: 1 1 1; dur: 200"></a-plane>
    </a-entity>
    <a-circle
        id="statusAudioStart" 
        radius="0.05" 
        position="-3.0 1.4 0.01" 
        material="color: gray" 
        data-permission="audio"
    ></a-circle>
    <a-text 
        id="statusAudioText" 
        value="Mikro" 
        color="#fff" 
        align="center" 
        width="2"
        position="-3.0 1.3 0.01"
    ></a-text>

    <a-circle 
        id="statusDataStart" 
        radius="0.05" 
        position="-2.7 1.4 0.01" 
        material="color: gray" 
        data-permission="data"
    ></a-circle>
    <a-text 
        id="statusDataText" 
        value="Daten" 
        color="#fff" 
        align="center" 
        width="2"
        position="-2.7 1.3 0.01"
    ></a-text>
  </a-entity>
  

  <!-- Startbutton -->
  <a-entity id="permissionBtn" visible="true" position="0 3 -1.9" class="clickable">
    <a-plane id="plane" width="2" height="0.4" color="#2563eb" opacity="0.9"
      class="clickable"
      animation__hoverin="startEvents: mouseenter; property: scale; to: 1.1 1.1 1; dur: 200"
      animation__hoverout="startEvents: mouseleave; property: scale; to: 1 1 1; dur: 200" position="0 0 0.05">
    </a-plane>
    <a-text id="permissionBtnText" value="Start" align="center" color="#fff" width="6" position="0 0 0.05"></a-text>
  </a-entity>


  <!-- Gewinnanzeige -->

<a-plane id="quizWin" width="5" height="2" color="#111" opacity="0.8" position="0 4 -3" visible="false">
    <a-text id="quizDone" value="Sehr gut! Du hast alle Aufgaben abgeschlossen! Klicke auf „Neustart“, um eine neue Runde zu starten." align="center" color="#fff" width="3" position="0 0 0.1"></a-text>   
    <a-text id="quizResult" value="Sehr gut! Du hast alle Aufgaben abgeschlossen! Klicke auf „Neustart“, um eine neue Runde zu starten." align="center" color="#fff" width="4" position="0 0.6 0.1"></a-text>   
    <a-entity id="restartButtonVR" visible="false" position="0 -0.5 0.03" class="clickable" animation__hoverin="startEvents: mouseenter; property: scale; to: 1.1 1.1 1; dur: 200"
      animation__hoverout="startEvents: mouseleave; property: scale; to: 1 1 1; dur: 200">
      <a-plane 
        id="restartPlane" 
        width="1.5" 
        height="0.3" 
        color="#1e90ff" 
        opacity="0.95" 
        shader="flat" 
        class="clickable"
        material="side: double">
      </a-plane>
      <a-text 
        value="Neustart" 
        align="center" 
        color="#fff" 
        width="4" 
        position="0 0 0.05">
      </a-text>
    </a-entity>
  </a-plane>

    <!-- Quizbereich -->

  <a-entity id="quizContainer" visible="false" position="0 4 -2">
    <a-plane width="6" height="3.5" color="#fff" opacity="0.9"></a-plane>
    <a-entity id="micLamp" position="-2.8 1.6 0.01" visible="false">
      <a-sphere id="micSphere" radius="0.02"  opacity="0.8" shader="flat"></a-sphere>
      <a-text id="mictx" width="1.5" value="MIC" align="center" color="#fff" position="0 -0.1 0"></a-text>
    </a-entity>
    <a-entity id="quizStatusRoot" position="0 1.5 0">
      <a-text 
          id="solvedTasksDisplay" 
          value="Aufgabe: 0 / X" 
          color="#000" 
          width="3" 
          align="center" 
          position="0 0 0.1">
      </a-text>
    </a-entity>
    <a-entity id="loadProgressBtn"
          geometry="primitive: plane; width: 0.8; height: 0.2"
          material="color: #4a90e2"
          text="value: Fortschritt laden; color: #fff; align: center; width: 2"
          position="2.5 1.5 0.1"
          class="clickable"
          visible="false" 
          animation__hoverin="startEvents: mouseenter; property: scale; to: 1.1 1.1 1; dur: 200"
          animation__hoverout="startEvents: mouseleave; property: scale; to: 1 1 1; dur: 200">
    </a-entity>
     <!-- Immersiver Sync-Hinweis -->
    <a-entity id="syncNoticeVR" visible="false" position="2.5 1.5 0.1">
      <a-text
        value="Fortschritt gespeichert"
        align="center"
        color="#fff"
        width="2"
        opacity="0.9"
        position="0 0.4 0"
        shader="msdf">
      </a-text>
    </a-entity>

    <!-- In-Game Permission Indicators -->
    <a-circle 
        id="statusAudioGame" 
        radius="0.03" 
        position="-2.3 1.6 0.01" 
        material="color: gray" 
        visible="false"
    ></a-circle>
    <a-text 
        id="statusAudioText" 
        value="Mikro" 
        color="#fff" 
        align="center" 
        width="1.75"
        position="-2.3 1.5 0.01"
    ></a-text>
    <a-circle 
        id="statusDataGame" 
        radius="0.03" 
        position="-2 1.6 0.01" 
        material="color: gray" 
        visible="false"
    ></a-circle>
    <a-text 
        id="statusDataText" 
        value="Daten" 
        color="#fff" 
        align="center" 
        width="1.75"
        position="-2 1.5 0.01"
    ></a-text>
  
    <a-text id="questionText" value="Was ist 3 + 4 ?" align="center" color="#000" width="6" position="0 0.5 0.05"></a-text>

    <a-entity id="answers" position="0 -0.5 0">
      <a-plane class="answer clickable" color="#2563eb" width="2" height="0.5" position="-1.5 0 0.05" animation__hoverin="startEvents: mouseenter; property: scale; to: 1.1 1.1 1; dur: 200"
      animation__hoverout="startEvents: mouseleave; property: scale; to: 1 1 1; dur: 200">
        <a-text value="6" align="center" color="#fff" width="4" position="0 0 0.05"></a-text>
      </a-plane>
      <a-plane class="answer clickable" color="#2563eb" width="2" height="0.5" position="1.5 0 0.05" animation__hoverin="startEvents: mouseenter; property: scale; to: 1.1 1.1 1; dur: 200"
      animation__hoverout="startEvents: mouseleave; property: scale; to: 1 1 1; dur: 200">
        <a-text value="7" align="center" color="#fff" width="4" position="0 0 0.05"></a-text>
      </a-plane>
    </a-entity>
  </a-entity>


<!-- Firebase-Popup -->
<a-entity id="popup-wrapper" visible="false" position="0 4 0">
  <a-plane id="popup-bg" width="3" height="2" color="#222" opacity="0.9" material="shader:flat" radius="0.05"></a-plane>
  
  <a-text 
    id="popup-head" 
    value=" " 
    color="#fff" 
    align="center" 
    width="3" 
    position="0 0.8 0.02">
  </a-text>
  <a-text 
    id="popup-text" 
    value=" " 
    color="#fff" 
    align="center" 
    width="2" 
    position="0 0.25 0.02">
  </a-text>

  <!-- ✅ Remember Checkbox + Label -->
  <a-plane id="rememberBox" width="0.1" height="0.1" color="#fff" position="-0.45 -0.3 0.02" class="clickable" material="shader:flat; side:double; stroke:#fff; strokeWidth:0.01"></a-plane>
  <a-text id="rememberLabel" value="Entscheidung merken" color="#fff" align="left" width="2" position="-0.3 -0.3 0.03"></a-text>
  
  <!-- ✅ Häkchen, wird per JS ein/ausgeblendet -->
  <a-text id="rememberCheck" value="X" color="#000" align="center" width="2" position="-0.45 -0.3 0.05" visible="false"></a-text>

  <!-- Buttons -->
  <a-box id="popup-allow" class="clickable" color="#0f0" depth="0.05" height="0.2" width="0.5" position="0.3 -0.6 0.02"></a-box>
  <a-text value="Erlauben" align="center" color="#000" width="2" position="0.3 -0.6 0.05"></a-text>

  <a-box id="popup-deny" class="clickable" color="#f00" depth="0.05" height="0.2" width="0.5" position="-0.3 -0.6 0.02"></a-box>
  <a-text value="Ablehnen" align="center" color="#000" width="2" position="-0.3 -0.6 0.05"></a-text>
</a-entity>

</a-scene>

<script type="module" src="vr_math_state.js"></script>
</body>
</html>




